(this["webpackJsonpswitch-game"]=this["webpackJsonpswitch-game"]||[]).push([[0],{113:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),r=n(13),c=n.n(r),o=n(25),i=n.n(o),s=n(14),u=n(3);var m=function(e){return e.scan((function(e,t){if(u.is(Function,t))return t(e);throw Error("dispatched value must be a function, got ".concat(typeof t))}),null).skipDuplicates()},p=n(23),d=n.n(p),v=function(e){return{width:"".concat(e,"px"),height:"".concat(e,"px"),fontSize:"".concat(Math.round(e/4),"px"),lineHeight:"".concat(Math.round(e/2.2),"px")}},f=function(e){var t=e.cell,n=e.size,a=e.onClick;return l.a.createElement("div",{className:"cell",onClick:a,style:v(n)},l.a.createElement("div",{className:d()(t.type,{inner:!0,WAIT:"WAIT"===t.label,TAP:"TAP"===t.label})},l.a.createElement("div",null,"off"===t.label?null:t.label),l.a.createElement("div",null,null==t.countdown?null:t.countdown)))},h=n(23),g=function(e){return{width:e,height:e,fontSize:"".concat(Math.round(e/8),"px")}},b=function(e){var t=e.state,n=e.size;return l.a.createElement("div",{className:h({"show-message":t.gameIsLose||t.levelComplete||t.startingMessage,"hide-message":!t.gameIsLose&&!t.levelComplete&&!t.startingMessage}),style:g(n)},l.a.createElement("div",null,l.a.createElement("div",null,t.gameIsLose?"You lose":t.levelComplete?"Level ".concat(t.level," complete!"):t.startingMessage?"How to play?":null),l.a.createElement("div",null,t.gameIsLose?"Score: ".concat(t.score):t.levelComplete?"Get ready!":t.startingMessage?l.a.createElement("div",{className:"rules"},l.a.createElement("div",null,"Tap a tile when it turns green."),l.a.createElement("div",null,"You win when no more tile is available."),l.a.createElement("div",null,"Don't miss any or the game ends!")):null),l.a.createElement("div",null,t.gameIsLose||t.startingMessage?"Swipe to start new game":"Swipe to start next level")))},w=[{width:"60px",height:"60px",opacity:"1"},{width:"120px",height:"120px",opacity:"0"}],E={duration:600,iterations:1},y=function(){var e=window.innerHeight-100;return window.innerWidth>e?e-20:window.innerWidth-20},x=function(e){return Math.floor(y()/Math.sqrt(e))},T=function(){var e=y();return{width:e,height:e}},I=function(e){var t=e.state,n=e.onCellTap,a=x(t.cells.length);return l.a.createElement("div",{className:"grid",style:T()},l.a.createElement(b,{size:y(),state:t}),t.cells.map((function(e,t){return l.a.createElement(f,{className:"game-cell",cell:e,size:a,onClick:function(){return n(e)},key:t})})))},k=n(15),O=n(16),j=n(19),A=n(17),C=n(20),M=function(e){function t(e){var n;return Object(k.a)(this,t),(n=Object(j.a)(this,Object(A.a)(t).call(this,e))).animation=null,n.circle=l.a.createRef(),n}return Object(C.a)(t,e),Object(O.a)(t,[{key:"animate",value:function(){this.animation=this.circle.current.animate(w,E)}},{key:"componentDidUpdate",value:function(e){this.props.value!==e.value&&this.animate()}},{key:"render",value:function(){var e=this.props,t=e.label,n=e.value;return l.a.createElement("div",{className:"progress-bar"},l.a.createElement("div",null,t),l.a.createElement("div",null,n),l.a.createElement("div",{ref:this.circle,className:"animation-circle"}))}}]),t}(a.Component),S=n(21),W={cells:[],level:1,levelComplete:!1,startingMessage:!0,gameIsLose:!1,gameIsPassed:!1,score:0,best:0},N=u.compose(u.all(u.equals(u.F())),u.values,u.pick(["gameIsLose","levelComplete","gameIsPassed","startingMessage"])),L=u.propEq("levelComplete",u.T()),P=n(5),z=function(e,t){return function(n){function a(e){var t;return Object(k.a)(this,a),(t=Object(j.a)(this,Object(A.a)(a).call(this,e))).state={},t}return Object(C.a)(a,n),Object(O.a)(a,[{key:"UNSAFE_componentWillMount",value:function(){var t=this,n=P.a(e).throttle(20,{leading:!1});this.sb=n.observe((function(e){t.setState(e)}))}},{key:"componentWillUnmount",value:function(){this.sb.unsubscribe()}},{key:"render",value:function(){return l.a.createElement(t,u.merge(this.props,this.state),this.props.children)}}]),a}(a.Component)},B=function(){var e=P.c.pool(),t=e.plug.bind(e);return e.plug=function(e){e instanceof P.c.Property||e instanceof P.c.Stream||e instanceof P.c.Observable?t(e):t(P.c.constant(e))},e},D=function(e,t){return e+Math.floor(Math.random()*t)},q=function(e){return e[D(0,e.length)]},F=function(e){return u.is(Object,e)?e.countdown>=2?Object(s.a)({},e,{countdown:e.countdown-1}):e:null},H=function(e){var t=e+1;return t*t},K=n(6),U=n.n(K);u.map2=u.addIndex(u.map);n(112),n(113);U.a.send("VKWebAppInit"),c.a.render(l.a.createElement((function(){var e,t,n,a,r,c,o,p,d,v,f,h,g,b,w,E,y,x,T;return i.a.async((function(k){for(;;)switch(k.prev=k.next){case 0:return x=function(e){return 1===e.countdown&&"WAIT"===e.label?{label:"TAP",countdown:4,index:e.index}:e},y=function(t){var n=!1;return t.cells.map((function(t){1===t.countdown&&"TAP"===t.label&&(n=!0,clearTimeout(e))})),n},E=function(n){var a=n.cells,l=u.filter((function(e){return null==e.countdown}),a);if(l.length){var r=q(l);return a=u.pipe(u.set2([r.index,"countdown"],5),u.set2([r.index,"label"],"WAIT"))(n.cells),clearTimeout(e),e=setTimeout((function(){t.plug(E)}),6e3),u.set2("cells",a,n)}return clearTimeout(e),u.pipe(h,u.assoc("levelComplete",u.T()))(n)},w=function(e){t.plug((function(t){return null!=e.countdown&&"WAIT"!==e.label?Object(s.a)({},t,{score:t.score+1,cells:u.set2([e.index,"countdown"],5,u.set2([e.index,"label"],"WAIT",t.cells))}):t}))},b=function(e){return Object(s.a)({},e,{levelComplete:!1,level:u.inc(e.level)})},g=function(e){return Object(s.a)({},e,{startingMessage:!1,gameIsLose:!1,gameIsPassed:!1,score:0,level:1})},h=function(e){var t=H(e.level),n=u.map2((function(e,t){return{label:"off",countdown:null,index:t}}),u.range(0,t));return Object(s.a)({},e,{cells:n})},e=null,t=B(),k.prev=9,k.next=12,i.a.awrap(U.a.sendPromise("VKWebAppStorageGet",{keys:["switchBest"]}));case 12:n=k.sent,console.log(n,"DATA"),a=n.keys.find((function(e){return"switchBest"===e.key})),t.plug((function(e){return u.set2("best",Number(a.value),e)})),k.next=21;break;case 18:k.prev=18,k.t0=k.catch(9),console.log("vk` storage error");case 21:return r=P.d(document.body,"touchmove").throttle(100).map((function(e){return function(e){return u.cond([[L,v],[u.complement(N),p],[u.T,u.always(e)]])(e)}})),c=P.e(1e3).map((function(e){return function(e){return u.ifElse(y,d,f)(e)}})),o=m(P.f([P.b((function(){return W})),t,c,r])),p=function(e){return u.pipe(g,h,E)(e)},d=function(e){var t=e.score,n=e.best;return U.a.send("VKWebAppStorageSet",{key:"switchBestScore",value:String(n)}),u.pipe(h,u.assoc("gameIsLose",u.T),u.assoc("best",t>n?t:n))(e)},v=function(e){return u.pipe(b,h,E)(e)},f=function(e){return u.over2("cells",u.map(u.pipe(x,F)))(e)},t.plug(h),T=z({state:o},(function(e){var t=e.state;return l.a.createElement(S.c,{activePanel:"main"},l.a.createElement(S.a,{id:"main",theme:"white"},l.a.createElement(S.b,{theme:"alternate",noShadow:!0},"Switch"),l.a.createElement("div",{className:"game"},l.a.createElement("div",{className:"game-progress"},l.a.createElement(M,{label:"Level",value:t.level}),l.a.createElement(M,{label:"Score",value:t.score}),l.a.createElement(M,{label:"Best",value:t.best})),l.a.createElement(I,{state:t,onCellTap:w}))))})),k.abrupt("return",l.a.createElement(T,null));case 31:case"end":return k.stop()}}),null,null,[[9,18]])}),null),document.getElementById("app"))},98:function(e,t,n){e.exports=n(115)}},[[98,1,2]]]);
//# sourceMappingURL=main.7722fb87.chunk.js.map