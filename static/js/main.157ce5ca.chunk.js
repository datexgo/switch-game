(this["webpackJsonpswitch-game"]=this["webpackJsonpswitch-game"]||[]).push([[0],{111:function(e,t,n){},113:function(e,t,n){"use strict";n.r(t);var a=n(0),l=n.n(a),r=n(13),c=n.n(r),i=n(14),s=n(2);var o=function(e){return e.scan((function(e,t){if(s.is(Function,t))return t(e);throw Error("dispatched value must be a function, got ".concat(typeof t))}),null).skipDuplicates()},u=n(23),m=n.n(u),p=s.compose(s.all(s.equals(s.F())),s.values,s.pick(["gameIsLose","levelComplete","gameIsPassed","startingMessage"])),d=s.propEq("levelComplete",s.T()),v=s.pipe(s.prop("keys"),s.find(s.propEq("key","switchBest")),s.prop("value"),Number,s.defaultTo(0)),f=function(e){return{width:"".concat(e,"px"),height:"".concat(e,"px"),fontSize:"".concat(Math.round(e/4),"px"),lineHeight:"".concat(Math.round(e/2.2),"px")}},h=function(e){var t=e.cell,n=e.size,a=e.onClick;return l.a.createElement("div",{className:"cell",onClick:a,style:f(n)},l.a.createElement("div",{className:m()(t.type,{inner:!0,WAIT:"WAIT"===t.label,TAP:"TAP"===t.label})},l.a.createElement("div",null,"off"===t.label?null:function(e){return"WAIT"===e.label?"\u0416\u0414\u0418":"\u0416\u041c\u0418"}(t)),l.a.createElement("div",null,null==t.countdown?null:t.countdown)))},g=n(23),b=function(e){return{width:e,height:e,fontSize:"".concat(Math.round(e/8),"px")}},E=function(e){var t=e.state,n=e.size;return l.a.createElement("div",{className:g({"show-message":t.gameIsLose||t.levelComplete||t.startingMessage,"hide-message":!t.gameIsLose&&!t.levelComplete&&!t.startingMessage}),style:b(n)},l.a.createElement("div",{className:"message"},l.a.createElement("div",null,t.gameIsLose?l.a.createElement("div",{className:"rules-header"},"\u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439 \u0441\u043d\u043e\u0432\u0430"):t.levelComplete?l.a.createElement("div",{className:"rules-header"},"\u0423\u0440\u043e\u0432\u0435\u043d\u044c ",t.level," \u043f\u0440\u043e\u0439\u0434\u0435\u043d"):t.startingMessage?l.a.createElement("div",{className:"rules-header"},"\u041f\u0440\u0430\u0432\u0438\u043b\u0430"):null,l.a.createElement("div",null,t.gameIsLose?"\u0421\u0447\u0435\u0442: ".concat(t.score):t.levelComplete?l.a.createElement("div",{className:"get-ready"},"\u041f\u0440\u0438\u0433\u043e\u0442\u043e\u0432\u044c\u0441\u044f!"):t.startingMessage?l.a.createElement("div",{className:"rules"},l.a.createElement("div",null,"\u0416\u043c\u0438 \u043d\u0430 \u0431\u0438\u0440\u044e\u0437\u043e\u0432\u044b\u0435 \u044f\u0447\u0435\u0439\u043a\u0438."),l.a.createElement("div",null,"\u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0438\u0442\u0441\u044f, \u043a\u043e\u0433\u0434\u0430 \u043d\u0435 \u043e\u0441\u0442\u0430\u043d\u0435\u0442\u0441\u044f \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0445 \u043a\u043b\u0435\u0442\u043e\u043a."),l.a.createElement("div",null,"\u041d\u0435 \u0443\u043f\u0443\u0441\u0442\u0438 \u043d\u0438 \u043e\u0434\u043d\u043e\u0439!")):null)),l.a.createElement("div",{className:"swipe"},l.a.createElement("div",{className:"swipe-header"},"\u0421\u0432\u0430\u0439\u043f\u043d\u0438"),l.a.createElement("div",{className:"swipe-tip"},t.gameIsLose||t.startingMessage?"\u0438 \u0438\u0433\u0440\u0430\u0439":"\u0438 \u043f\u0440\u043e\u0434\u043e\u043b\u0436\u0438"))))},w=[{width:"60px",height:"60px",opacity:"0"},{width:"90px",height:"90px",opacity:"0.1",offset:.3},{width:"110px",height:"110px",opacity:"0"}],y={duration:600,iterations:1},I=function(){var e=window.innerHeight-100;return window.innerWidth>e?e-20:window.innerWidth-20},T=function(e){return Math.floor(I()/Math.sqrt(e))},x=function(){var e=I();return{width:e,height:e}},N=function(e){var t=e.state,n=e.onCellTap,a=T(t.cells.length);return l.a.createElement("div",{className:"grid",style:x()},l.a.createElement(E,{size:I(),state:t}),t.cells.map((function(e,t){return l.a.createElement(h,{className:"game-cell",cell:e,size:a,onClick:function(){return n(e)},key:t})})))},k=n(15),O=n(16),j=n(19),C=n(17),M=n(20),A=function(e){function t(e){var n;return Object(k.a)(this,t),(n=Object(j.a)(this,Object(C.a)(t).call(this,e))).animation=null,n.circle=l.a.createRef(),n}return Object(M.a)(t,e),Object(O.a)(t,[{key:"animate",value:function(){this.animation=this.circle.current.animate(w,y)}},{key:"componentDidUpdate",value:function(e){this.props.value!==e.value&&this.animate()}},{key:"render",value:function(){var e=this.props,t=e.label,n=e.value;return l.a.createElement("div",{className:"progress-bar"},l.a.createElement("div",null,t),l.a.createElement("div",null,n),l.a.createElement("div",{ref:this.circle,className:"animation-circle"}))}}]),t}(a.Component),W=n(21),S=n(6),P=n.n(S),L={cells:[],level:1,levelComplete:!1,startingMessage:!0,gameIsLose:!1,gameIsPassed:!1,score:0,best:0},z=n(5),q=function(e,t){return e+Math.floor(Math.random()*t)},B=function(e){return e[q(0,e.length)]},V=function(e){return s.is(Object,e)?e.countdown>=2?Object(i.a)({},e,{countdown:e.countdown-1}):e:null},F=function(e){var t=e+1;return t*t};s.map2=s.addIndex(s.map);n(110),n(111);P.a.send("VKWebAppInit",{}),c.a.render(l.a.createElement((function(){var e=null,t=function(){var e=z.c.pool(),t=e.plug.bind(e);return e.plug=function(e){e instanceof z.c.Property||e instanceof z.c.Stream||e instanceof z.c.Observable?t(e):t(z.c.constant(e))},e}();z.e(P.a.sendPromise("VKWebAppStorageGet",{keys:["switchBest"]})).onValue((function(e){t.plug((function(t){return s.set2("best",v(e),t)}))}));var n=z.d(document.body,"touchmove").throttle(100).map((function(e){return function(e){return s.cond([[d,f],[s.complement(p),u],[s.T,s.always(e)]])(e)}})),r=z.f(1e3).map((function(e){return function(e){return s.ifElse(I,m,h)(e)}})),c=o(z.g([z.b((function(){return L})),t,r,n])),u=function(e){return s.pipe(b,g,y)(e)},m=function(e){var t=e.score,n=e.best,a=s.max(t,n);return P.a.send("VKWebAppStorageSet",{key:"switchBest",value:String(a)}),s.pipe(g,s.assoc("gameIsLose",s.T),s.assoc("best",a))(e)},f=function(e){return s.pipe(E,g,y)(e)},h=function(e){return s.over2("cells",s.map(s.pipe(T,V)))(e)};function g(e){var t=F(e.level),n=s.map2((function(e,t){return{label:"off",countdown:null,index:t}}),s.range(0,t));return Object(i.a)({},e,{cells:n})}function b(e){return Object(i.a)({},e,{startingMessage:!1,gameIsLose:!1,gameIsPassed:!1,score:0,level:1})}function E(e){return Object(i.a)({},e,{levelComplete:!1,level:s.inc(e.level)})}function w(e){t.plug((function(t){return null!=e.countdown&&"WAIT"!==e.label?Object(i.a)({},t,{score:t.score+1,cells:s.set2([e.index,"countdown"],5,s.set2([e.index,"label"],"WAIT",t.cells))}):t}))}function y(n){var a=n.cells,l=s.filter((function(e){return null==e.countdown}),a);if(l.length){var r=B(l);return a=s.pipe(s.set2([r.index,"countdown"],5),s.set2([r.index,"label"],"WAIT"))(n.cells),clearTimeout(e),e=setTimeout((function(){t.plug(y)}),6e3),s.set2("cells",a,n)}return clearTimeout(e),s.pipe(g,s.assoc("levelComplete",s.T()))(n)}function I(t){var n=!1;return t.cells.map((function(t){1===t.countdown&&"TAP"===t.label&&(n=!0,clearTimeout(e))})),n}function T(e){return 1===e.countdown&&"WAIT"===e.label?{label:"TAP",countdown:4,index:e.index}:e}t.plug(g);var x,S,q=(x={state:c},S=function(e){var t=e.state;return l.a.createElement(W.c,{activePanel:"main"},l.a.createElement(W.a,{id:"main",theme:"white"},l.a.createElement(W.b,{transparent:!0,noShadow:!0},"Switch"),l.a.createElement("div",{className:"game"},l.a.createElement("div",{className:"game-progress"},l.a.createElement(A,{label:"\u0423\u0440\u043e\u0432\u0435\u043d\u044c",value:t.level}),l.a.createElement(A,{label:"\u0421\u0447\u0435\u0442",value:t.score}),l.a.createElement(A,{label:"\u0422\u043e\u043f",value:t.best})),l.a.createElement(N,{state:t,onCellTap:w}))))},function(e){function t(e){var n;return Object(k.a)(this,t),(n=Object(j.a)(this,Object(C.a)(t).call(this,e))).state={},n}return Object(M.a)(t,e),Object(O.a)(t,[{key:"UNSAFE_componentWillMount",value:function(){var e=this,t=z.a(x).throttle(20,{leading:!1});this.sb=t.observe((function(t){e.setState(t)}))}},{key:"componentWillUnmount",value:function(){this.sb.unsubscribe()}},{key:"render",value:function(){return l.a.createElement(S,s.merge(this.props,this.state),this.props.children)}}]),t}(a.Component));return l.a.createElement(q,null)}),null),document.getElementById("app"))},97:function(e,t,n){e.exports=n(113)}},[[97,1,2]]]);
//# sourceMappingURL=main.157ce5ca.chunk.js.map